================================================================================
Commit: f008a1ee4944a3f19532560a0c4e1a8386649bb3
Auteur: Claude <noreply@anthropic.com>
Date: 2026-01-20 23:32:05 +0000
Sujet: Disable QR code and browser open button in device-app

Changes:
- Removed QR code generation (qrcode.toDataURL) from server
- Removed QR code display from UI
- Removed "Ouvrir dans le navigateur" button
- These features don't work inside Docker containers

Users must now manually:
1. Visit https://localhost:3000/activate
2. Copy/paste the user code displayed on device page

This is the correct workflow for OAuth2 Device Flow in production.


================================================================================
Commit: f9904eeb87cf561c3868593b142f3f5341b9c909
Auteur: Claude <noreply@anthropic.com>
Date: 2026-01-20 23:21:42 +0000
Sujet: Fix: Keep end_session_endpoint with public URL for browser redirects

The end_session_endpoint (logout) is used for browser redirects,
not server-to-server API calls. It must use the public URL
(localhost:8080) so the user's browser can access it.

Also keep registration_endpoint with public URL for same reason.

Only true server-to-server endpoints (token, userinfo, revocation,
introspection, jwks_uri) should use the internal Docker URL.

This fixes ERR_NAME_NOT_RESOLVED when clicking logout.


================================================================================
Commit: 8b73954d716fa9b86b48a9f39b07fb7f7addf43b
Auteur: Claude <noreply@anthropic.com>
Date: 2026-01-20 23:17:34 +0000
Sujet: Add axios dependency to webapp

The /devices route requires axios to call Keycloak Account API,
but it was not listed in package.json dependencies.

Added axios ^1.6.0 to fix MODULE_NOT_FOUND error.


================================================================================
Commit: a88a5989cc488554eb88f2fe81f67c0b1768fcf8
Auteur: Claude <noreply@anthropic.com>
Date: 2026-01-20 23:13:54 +0000
Sujet: Fix /devices route to use internal Keycloak URL

The /devices route was calling Keycloak Account API using
KEYCLOAK_URL (localhost:8080) which fails inside Docker.

Changed to use KEYCLOAK_INTERNAL_URL (keycloak:8080) for
server-to-server API calls to fetch device sessions.

This fixes ERR_CONNECTION_CLOSED when accessing /devices page.


================================================================================
Commit: c51931b2dfe9b9b97424e0a5c0e8cf2805033dea
Auteur: Claude <noreply@anthropic.com>
Date: 2026-01-20 23:07:11 +0000
Sujet: Fix device-app server startup and Docker networking

Changes:
- Check if HTTPS certificates exist before trying to load them
- Better error handling for HTTPS startup failures
- Listen on 0.0.0.0 instead of default (required for Docker)
- Improved fallback to HTTP when certificates are missing
- More informative startup messages

This fixes ERR_EMPTY_RESPONSE when accessing localhost:4000


================================================================================
Commit: 7fa9a7c4105353a396f25749c146f65b299b10b4
Auteur: Claude <noreply@anthropic.com>
Date: 2026-01-20 23:02:48 +0000
Sujet: Fix device-app to use internal Keycloak URL

Updated device-app to use KEYCLOAK_INTERNAL_URL (http://keycloak:8080)
instead of KEYCLOAK_URL (http://localhost:8080) for server-to-server
API calls within Docker.

This fixes the device flow initialization which was failing to contact
Keycloak when running inside Docker containers.


================================================================================
Commit: feebf14f5dda16fbcf94a56a59f398bae573a6a3
Auteur: Claude <noreply@anthropic.com>
Date: 2026-01-20 22:56:39 +0000
Sujet: Fix: Add jwks_uri override to prevent localhost connection

Added jwks_uri and registration_endpoint to the corrected metadata.
The jwks_uri is critical as it's used by openid-client to fetch
public keys for JWT token validation. Without this override, the
library was still trying to connect to localhost (::1:8080) even
though other endpoints were corrected.

This completes the fix for ECONNREFUSED errors.


================================================================================
Commit: 903fb3bb3e6a9466e33cc3346d37a3b4353be160
Auteur: Claude <noreply@anthropic.com>
Date: 2026-01-20 22:33:12 +0000
Sujet: Fix OAuth2 token exchange error in Docker environment

Fixed ECONNREFUSED error when webapp tries to exchange authorization
code for tokens. The issue was that openid-client library was using
localhost:8080 (from Keycloak's issuer metadata) for token endpoint
calls, which failed inside Docker containers.

Solution:
- Discover issuer from internal URL (http://keycloak:8080)
- Override server-to-server endpoints (token, userinfo, revocation)
  to use internal Docker hostname
- Keep authorization endpoint using public URL (http://localhost:8080)
  for browser redirects

This ensures backend-to-backend calls use Docker networking while
user-facing redirects remain accessible from the host browser.

Fixes the error:
  Error: connect ECONNREFUSED ::1:8080

